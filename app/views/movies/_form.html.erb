<%= semantic_form_for @movie,
                      html: {multipart: true} do |f| %>

    <%= error_messages_for(f.object) %><br/>

    <div id="poster-thumbnail">
      <%= link_to(image_tag(@movie.poster.url(:small)),
                  @movie.poster.url,
                  target: "_blank") %>
      <br/>
      <%= link_to("Search Box Office Mojo",
                  "http://www.boxofficemojo.com/search/?q=" + CGI.escape(@movie.movie_title.to_s),
                  target: "_blank") %>
      <br/>
      <%= link_to("Search Yahoo Movies",
                  "http://movies.yahoo.com/mv/search?fr=ush-movies&toggle=1&cop=&ei=UTF-8&p=" + CGI.escape(@movie.movie_title.to_s),
                  target: "_blank") %>
      <br/>
      <%= link_to("Search Taiwan Yahoo Movies",
                  "http://tw.movie.yahoo.com/moviesearch_result.html?qmv=" + CGI.escape(@movie.movie_title.to_s),
                  target: "_blank") %>
      <br/>
      <%= link_to("Search Rotten Tomatoes",
                  "http://www.rottentomatoes.com/search/full_search.php?search=" + CGI.escape(@movie.movie_title.to_s),
                  target: "_blank") %>
      <br/>
      <%= link_to("Search IMDB",
                  "http://www.imdb.com/find?s=all&q=" + CGI.escape(@movie.movie_title.to_s),
                  target: "_blank") %>
      <br/>
      <%= link_to("Search Mtime",
                  "http://www.mtime.com/search/?" + CGI.escape(@movie.movie_title.to_s),
                  target: "_blank") %>
      <br/>
      <br/>
      <%= f.input :poster,
                  input_html: {tabindex: 29},
                  label: "Poster Image",
                  as: :file,
                  input_html: {size: 6} %>
      <br/>
      <a href="http://images.google.com/images?hl=en&q=movie+<%= CGI.escape(@movie.movie_title.to_s) %>" target="_blank">
        Search Google Images
      </a>
      <br/>
      <br/>
      <%= f.actions %>
      <%= link_to "Add EPK",
                  {controller: :videos,
                   action: "new",
                   id: params[:id],
                   video_type: CGI.escape("Movie EPK")} %>
      <br/>
      <%= link_to "Add Trailer",
                  {controller: :videos,
                   action: "new",
                   id: params[:id],
                   video_type: CGI.escape("Movie Trailer")} %>
      <br/>
      <%= link_to "Add Master",
                  {controller: :videos,
                   action: "new",
                   id: params[:id],
                   video_type: CGI.escape("Movie Master")} %>
      <br/>
      <%= link_to "Add TV Special",
                  {controller: :videos,
                   action: "new",
                   id: params[:id],
                   video_type: CGI.escape("TV Special")} %>
    </div>

    <%= f.inputs do %>

        <div id="movie-fields">
        <%= f.input :movie_title,
                    label: "Movie Title",
                    input_html: {tabindex: 1},
                    size: 5 %>
        <%= f.input :chinese_movie_title,
                    label: "Chinese Movie Title",
                    input_html: {tabindex: 2},
                    size: 5 %>
        <!-- TODO: Update to Rails 3 -->
        <%= f.input :movie_type,
                    label: "Movie Type",
                    as: :select,
                    collection: Movie::MOVIE_TYPE,
                    include_blank: true,
                    input_html: {tabindex: 3} %>

        <% if @movie.movie_type=="Hollywood Movie" %>
            <%= f.input :foreign_language_title,
                        label: "Foreign Language Title",
                        input_html: {disabled: true,
                                     tabindex: 4} %>
        <% else %>
            <%= f.input :foreign_language_title,
                        label: "Foreign Language Title",
                        input_html: {tabindex: 5} %>
        <% end %>

        <table border="0" cellpadding="0" cellspacing="0">
          <tr>
            <td valign="top">
              <%= f.input :movie_distributor,
                          include_blank: true,
                          input_html: {tabindex: 5},
                          label: ("Distributor " + link_to("[edit]",
                                                           suppliers_path,
                                                           target: "_blank")).html_safe,
                          collection: Supplier.movie_distributors.collect { |p| [p.company_name,
                                                                                 p.id] } %>
            </td>
            <td>
              <%= f.input :production_studio,
                          input_html: {tabindex: 7},
                          include_blank: true,
                          label: ("Production Studio " + link_to("[edit]",
                                                                 suppliers_path,
                                                                 target: "_blank")).html_safe,
                          collection: Supplier.production_studios.collect { |p| [p.company_name,
                                                                                 p.id] } %>
            </td>
            <td>
              <%= f.input :laboratory,
                          input_html: {tabindex: 8},
                          include_blank: true,
                          label: ("Laboratory " + link_to("[edit]",
                                                          suppliers_path,
                                                          target: "_blank")).html_safe,
                          collection: Supplier.laboratories.collect { |p| [p.company_name,
                                                                           p.id] } %>
            </td>
          </tr>
          <tr>
            <td>Airline Release Date
              <%= f.input :airline_release_date,
                          input_html: {tabindex: 9},
                          label: false,
                          labels: {month: false,
                                   year: false},
                          order: [:month,
                                  :year],
                          discard_day: true,
                          include_blank: true,
                          use_month_numbers: true,
                          start_year: Date.today.year + 2,
                          end_year: 1900 %>
            </td>
            <td>
              Personal Video Date
              <%= f.input :personal_video_date,
                          input_html: {tabindex: 10},
                          label: false,
                          labels: {month: false,
                                   year: false},
                          order: [:month,
                                  :year],
                          discard_day: true,
                          include_blank: true,
                          use_month_numbers: true,
                          start_year: Date.today.year + 2,
                          end_year: 1900 %>
            </td>
            <td valign="top">
              <%= f.input :theatrical_release_year,
                          input_html: {tabindex: 11},
                          label: "Theatrical Release Year" %>
            </td>
          </tr>
          <tr>
            <td>
              Screener Received Date
              <%= link_to '[today]',
                          update_date_path("movie_screener_received_date"),
                          remote: true %>
              <%= f.input :screener_received_date,
                          input_html: {tabindex: 12},
                          label: false,
                          labels: {day: false,
                                   month: false,
                                   year: false},
                          include_blank: true,
                          order: [:day,
                                  :month,
                                  :year],
                          use_short_month: true %>
            </td>
            <td>
              Screener Destroyed Date
              <%= link_to '[today]',
                          update_date_path("movie_screener_destroyed_date"),
                          remote: true %>
              <%= f.input :screener_destroyed_date,
                          input_html: {tabindex: 13},
                          order: [:day,
                                  :month,
                                  :year],
                          label: false,
                          labels: {day: false,
                                   month: false,
                                   year: false},
                          use_short_month: true,
                          include_blank: true %>
            </td>
            <td>
              <%= f.input :has_press_kit,
                          input_html: {tabindex: 14},
                          label: "Photo CD/Press Kit" %>
              <%= f.input :has_poster,
                          input_html: {tabindex: 15},
                          label: "Poster" %>
              <%= f.input :poster_quantity,
                          input_html: {tabindex: 16,
                                       size: 3},
                          label: ",
 &nbsp;Qty" %>
            </td>
          </tr>
          <tr>
            <td>
              <%= f.input :rating,
                          input_html: {tabindex: 17},
                          label: "Rating",
                          as: :select,
                          collection: %w(NR G PG PG-13 R NC-17),
                          include_blank: false %>
            </td>
            <td>
              <%= f.input :theatrical_runtime,
                          input_html: {tabindex: 18},
                          label: "Theatrical R/T (min)" %>
            </td>
            <td>
              <%= f.input :edited_runtime,
                          label: "Edited R/T (min)",
                          input_html: {tabindex: 19} %>
            </td>
          </tr>
        </table>
        <%= f.input :release_versions,
                    input_html: {tabindex: 20},
                    label: "Release Versions",
                    as: :check_boxes,
                    collection: Movie::RELEASE_VERSIONS %>

        <!-- TODO: Update to Rails 3 -->
        <%= f.input :screener_remarks,
                    label: "Screener Remarks",
                    as: :check_boxes,
                    collection: Movie::SCREENER_REMARKS,
                    input_html: {tabindex: 21} %>
        <%= f.input :screener_remarks_other,
                    input_html: {tabindex: 22},
                    label: "Other",
                    id: 'movie_screener_remarks_other_other',
                    input_html: @movie.screener_remarks.include?("Other") ? {disabled: false} : {disabled: true} %>


        <div class="clear"></div>

        <!-- TODO: Update to Rails 3 -->
        <%= f.input :airline_rights,
                    label: "Airline Rights",
                    as: :select,
                    collection: ["Worldwide",
                                 "Worldwide Excluding",
                                 "International Including",
                                 "North America",
                                 "Limited"],
                    include_blank: true,
                    input_html: {tabindex: 23} %>
        <%= f.input :airline_countries,
                    input_html: {disabled: ((@movie.airline_rights=="Worldwide") || (@movie.airline_rights=="North America")) ? true : false,
                                 tabindex: 24} %>
        <%= f.input :language_tracks,
                    input_html: {tabindex: 25},
                    label: ("Available Language<br/>Tracks").html_safe,
                    as: :check_boxes,
                    collection: @languages %>
        <%= f.input :language_subtitles,
                    input_html: {tabindex: 26},
                    label: ("Available Language<br/>Subtitles").html_safe,
                    as: :check_boxes,
                    collection: @languages %>
        <%= f.input :movie_genres,
                    collection: MovieGenre.order("name"),
                    input_html: {tabindex: 27},
                    label: "Movie Genre",
                    as: :check_boxes %>

        <%= f.input :cast,
                    input_html: {tabindex: 28} %>
        <%= f.input :chinese_cast,
                    input_html: {tabindex: 29},
                    label: "Cast (Chinese)" %>
        <%= f.input :director,
                    input_html: {tabindex: 30} %>
        <%= f.input :chinese_director,
                    input_html: {tabindex: 31},
                    label: "Director (Chinese)" %>
        <%= f.input :synopsis,
                    input_html: {tabindex: 32},
                    hint: ("(<span id='char_count' ></span > characters)").html_safe %>
        <%= f.input :chinese_synopsis,
                    input_html: {tabindex: 33},
                    label: "Chinese Synopsis",
                    hint: ("(<span id='chinese_char_count' ></span > characters)").html_safe %>
        <%= f.input :imdb_synopsis,
                    input_html: {tabindex: 34},
                    label: "IMDB Synopsis",
                    hint: ("(<span id='imdb_char_count' ></span > characters)").html_safe %>

        <%= f.input :critics_review,
                    input_html: {tabindex: 35},
                    label: ("Critics Review<br/>
                                  <a href='http://mingyi.org/T2F3' target='_blank'>Install TableTools</a>
                                  <br/>
                                  <br/>
                                  1. Right click on Critics Review table in Yahoo! Movies
                                  <br/>
                                  <br/>
                                  2. Click on
                                  <br/>
                                  Other Table Operations > Copy Filtered As HTML").html_safe %>

        <%= f.input :remarks,
                    input_html: {tabindex: 36,
                                 rows: 3},
                    hint: 'Only use this remarks field as a last resort' %>

        </div>
    <% end %>

    <center><%= f.actions %></center>
<% end %>

<script>

    var $ = jQuery;

    $(document).ready(function() {
    	
    	var chars,
      		chineseChars,
          imdbChars;
    	
    	chars = $('#movie_synopsis').val().length;
    	chineseChars = $('#movie_chinese_synopsis').val().length;
      imdbChars = $('#movie_imdb_synopsis').val().length;
    	
    	$('#char_count').html(chars);
    	$('#chinese_char_count').html(chineseChars);
      $('#imdb_char_count').html(imdbChars);
    	
    	$('#movie_synopsis').on("keyup change", function() {
	    	chars = $('#movie_synopsis').val().length;
	    	$('#char_count').html(chars);
    	});

    	$('#movie_chinese_synopsis').on("keyup change", function() {
	    	chineseChars = $('#movie_chinese_synopsis').val().length;
	    	$('#chinese_char_count').html(chineseChars);
    	});

      $('#movie_imdb_synopsis').on("keyup change", function() {
        imdbChars = $('#movie_imdb_synopsis').val().length;
        $('#imdb_char_count').html(imdbChars);
      });
    });


</script>